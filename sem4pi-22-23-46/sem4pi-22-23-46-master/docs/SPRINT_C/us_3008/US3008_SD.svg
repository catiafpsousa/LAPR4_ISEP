<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="549px" preserveAspectRatio="none" style="width:721px;height:549px;background:#FFFFFF;" version="1.1" viewBox="0 0 721 549" width="721.5px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="479.0742" style="stroke:#181818;stroke-width:0.3;" width="3" x="88.35" y="35.5711"/><rect fill="#FFFFFF" height="460.8633" style="stroke:#181818;stroke-width:0.3;" width="3" x="166.95" y="53.782"/><rect fill="#FFFFFF" height="441.4523" style="stroke:#181818;stroke-width:0.3;" width="3" x="265.05" y="75.893"/><rect fill="#FFFFFF" height="19.6055" style="stroke:#181818;stroke-width:0.3;" width="3" x="266.55" y="267.6305"/><rect fill="#FFFFFF" height="19.6055" style="stroke:#181818;stroke-width:0.3;" width="3" x="266.55" y="357.7688"/><rect fill="#FFFFFF" height="30.6164" style="stroke:#181818;stroke-width:0.3;" width="3" x="266.55" y="436.4016"/><rect fill="#FFFFFF" height="13.6055" style="stroke:#181818;stroke-width:0.3;" width="3" x="406.95" y="413.6906"/><rect fill="#FFFFFF" height="26.6109" style="stroke:#181818;stroke-width:0.3;" width="3" x="469.35" y="314.4469"/><rect fill="#FFFFFF" height="17.5055" style="stroke:#181818;stroke-width:0.3;" width="3" x="470.85" y="323.5523"/><rect fill="#FFFFFF" height="22.7109" style="stroke:#181818;stroke-width:0.3;" width="3" x="469.35" y="404.5852"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="540.75" y="278.2359"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="540.75" y="368.3742"/><rect fill="#FFFFFF" height="31.2164" style="stroke:#181818;stroke-width:0.3;" width="3" x="599.85" y="447.007"/><rect fill="#FFFFFF" height="23.0391" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="84.9984"/><rect fill="#FFFFFF" height="9.1055" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="184.7813"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="296.3414"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="386.4797"/><rect fill="#FFFFFF" height="9.1055" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="478.2234"/><rect fill="none" height="85.9383" style="stroke:#000000;stroke-width:0.44999999999999996;" width="483.45" x="236.4" y="253.0195"/><rect fill="none" height="82.0383" style="stroke:#000000;stroke-width:0.44999999999999996;" width="483.45" x="236.4" y="343.1578"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="6.6" x2="6.6" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="89.85" x2="89.85" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="168.45" x2="168.45" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="266.4" x2="266.4" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="408.3" x2="408.3" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="470.85" x2="470.85" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="542.25" x2="542.25" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="570.15" x2="570.15" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="601.35" x2="601.35" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="655.65" x2="655.65" y1="25.8656" y2="520.0453"/><line style="stroke:#181818;stroke-width:0.15;stroke-dasharray:5.0,5.0;" x1="700.05" x2="700.05" y1="25.8656" y2="520.0453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="8.7" x="1.5" y="24.9428">User</text><ellipse cx="6.75" cy="5.1328" fill="#E2E2F0" rx="2.4" ry="2.4" style="stroke:#181818;stroke-width:0.15;"/><path d="M6.75,7.5328 L6.75,15.6328 M2.85,9.9328 L10.65,9.9328 M6.75,15.6328 L2.85,20.1328 M6.75,15.6328 L10.65,20.1328 " fill="none" style="stroke:#181818;stroke-width:0.15;"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="8.7" x="1.5" y="524.1053">User</text><ellipse cx="6.75" cy="527.5781" fill="#E2E2F0" rx="2.4" ry="2.4" style="stroke:#181818;stroke-width:0.15;"/><path d="M6.75,529.9781 L6.75,538.0781 M2.85,532.3781 L10.65,532.3781 M6.75,538.0781 L2.85,542.5781 M6.75,538.0781 L10.65,542.5781 " fill="none" style="stroke:#181818;stroke-width:0.15;"/><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="54.6" x="62.55" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="28.5" x="75.6" y="17.26">«presentation»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="50.4" x="64.65" y="22.5428">UndoLastChangeInPostItUI</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="54.6" x="62.55" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="28.5" x="75.6" y="526.2053">«presentation»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="50.4" x="64.65" y="531.4881">UndoLastChangeInPostItUI</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="69.6" x="133.65" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="25.2" x="155.85" y="17.26">«application»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="65.4" x="135.75" y="22.5428">UndoLastChangeInPostItController</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="69.6" x="133.65" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="25.2" x="155.85" y="526.2053">«application»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="65.4" x="135.75" y="531.4881">UndoLastChangeInPostItController</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="54.3" x="239.4" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="25.2" x="253.95" y="17.26">«application»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="50.1" x="241.5" y="22.5428">BoardManagementService</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="54.3" x="239.4" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="25.2" x="253.95" y="526.2053">«application»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="50.1" x="241.5" y="531.4881">BoardManagementService</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="23.7" x="396.6" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="399.15" y="17.26">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="19.5" x="398.7" y="22.5428">parentCell</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="23.7" x="396.6" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="399.15" y="526.2053">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="19.5" x="398.7" y="531.4881">parentCell</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="22.8" x="459.45" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="461.55" y="17.26">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="7.2" x="467.25" y="22.5428">Cell</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="22.8" x="459.45" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="461.55" y="526.2053">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="7.2" x="467.25" y="531.4881">Cell</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="22.8" x="530.85" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="532.95" y="17.26">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="10.2" x="537.15" y="22.5428">postIt</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="22.8" x="530.85" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="532.95" y="526.2053">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="10.2" x="537.15" y="531.4881">postIt</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="27" x="556.65" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="560.85" y="17.26">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="22.8" x="558.75" y="22.5428">postItParent</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="27" x="556.65" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="560.85" y="526.2053">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="22.8" x="558.75" y="531.4881">postItParent</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="29.4" x="586.65" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="592.05" y="17.26">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="25.2" x="588.75" y="22.5428">SharedBoard</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="29.4" x="586.65" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="592.05" y="526.2053">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="25.2" x="588.75" y="531.4881">SharedBoard</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="49.8" x="630.75" y="10.8"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="646.35" y="17.26">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="45.6" x="632.85" y="22.5428">mod : BoardModification</text><rect fill="#E2E2F0" height="14.7656" rx="0.75" ry="0.75" style="stroke:#181818;stroke-width:0.15;" width="49.8" x="630.75" y="519.7453"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="18.6" x="646.35" y="526.2053">«domain»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="45.6" x="632.85" y="531.4881">mod : BoardModification</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="23.7" x="687.45" y="19.66">«repository»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="31.5" x="683.55" y="24.9428">boardRepository</text><path d="M694.8,4.5 C694.8,1.5 700.2,1.5 700.2,1.5 C700.2,1.5 705.6,1.5 705.6,4.5 L705.6,12.3 C705.6,15.3 700.2,15.3 700.2,15.3 C700.2,15.3 694.8,15.3 694.8,12.3 L694.8,4.5 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.44999999999999996;"/><path d="M694.8,4.5 C694.8,7.5 700.2,7.5 700.2,7.5 C700.2,7.5 705.6,7.5 705.6,4.5 " fill="none" style="stroke:#181818;stroke-width:0.44999999999999996;"/><text fill="#000000" font-family="FG Virgil" font-size="4.2" font-style="italic" lengthAdjust="spacing" textLength="23.7" x="687.45" y="524.1053">«repository»</text><text fill="#000000" font-family="FG Virgil" font-size="4.2" lengthAdjust="spacing" textLength="31.5" x="683.55" y="529.3881">boardRepository</text><path d="M694.8,533.3109 C694.8,530.3109 700.2,530.3109 700.2,530.3109 C700.2,530.3109 705.6,530.3109 705.6,533.3109 L705.6,541.1109 C705.6,544.1109 700.2,544.1109 700.2,544.1109 C700.2,544.1109 694.8,544.1109 694.8,541.1109 L694.8,533.3109 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.44999999999999996;"/><path d="M694.8,533.3109 C694.8,536.3109 700.2,536.3109 700.2,536.3109 C700.2,536.3109 705.6,536.3109 705.6,533.3109 " fill="none" style="stroke:#181818;stroke-width:0.44999999999999996;"/><rect fill="#FFFFFF" height="479.0742" style="stroke:#181818;stroke-width:0.3;" width="3" x="88.35" y="35.5711"/><rect fill="#FFFFFF" height="460.8633" style="stroke:#181818;stroke-width:0.3;" width="3" x="166.95" y="53.782"/><rect fill="#FFFFFF" height="441.4523" style="stroke:#181818;stroke-width:0.3;" width="3" x="265.05" y="75.893"/><rect fill="#FFFFFF" height="19.6055" style="stroke:#181818;stroke-width:0.3;" width="3" x="266.55" y="267.6305"/><rect fill="#FFFFFF" height="19.6055" style="stroke:#181818;stroke-width:0.3;" width="3" x="266.55" y="357.7688"/><rect fill="#FFFFFF" height="30.6164" style="stroke:#181818;stroke-width:0.3;" width="3" x="266.55" y="436.4016"/><rect fill="#FFFFFF" height="13.6055" style="stroke:#181818;stroke-width:0.3;" width="3" x="406.95" y="413.6906"/><rect fill="#FFFFFF" height="26.6109" style="stroke:#181818;stroke-width:0.3;" width="3" x="469.35" y="314.4469"/><rect fill="#FFFFFF" height="17.5055" style="stroke:#181818;stroke-width:0.3;" width="3" x="470.85" y="323.5523"/><rect fill="#FFFFFF" height="22.7109" style="stroke:#181818;stroke-width:0.3;" width="3" x="469.35" y="404.5852"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="540.75" y="278.2359"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="540.75" y="368.3742"/><rect fill="#FFFFFF" height="31.2164" style="stroke:#181818;stroke-width:0.3;" width="3" x="599.85" y="447.007"/><rect fill="#FFFFFF" height="23.0391" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="84.9984"/><rect fill="#FFFFFF" height="9.1055" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="184.7813"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="296.3414"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="386.4797"/><rect fill="#FFFFFF" height="9.1055" style="stroke:#181818;stroke-width:0.3;" width="3" x="698.7" y="478.2234"/><polygon fill="#181818" points="84.75,34.3711,87.75,35.5711,84.75,36.7711,85.95,35.5711" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="6.75" x2="86.55" y1="35.5711" y2="35.5711"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="45.3" x="8.85" y="34.1142">undo last change in PostIt</text><polygon fill="#181818" points="164.85,43.4766,167.85,44.6766,164.85,45.8766,166.05,44.6766" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="91.35" x2="166.65" y1="44.6766" y2="44.6766"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="13.2" x="93.45" y="43.2196">create()</text><polygon fill="#181818" points="163.35,52.582,166.35,53.782,163.35,54.982,164.55,53.782" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="91.35" x2="165.15" y1="53.782" y2="53.782"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="63.3" x="93.45" y="52.3251">sharedBoardsWithWritePermission()</text><line style="stroke:#181818;stroke-width:0.3;" x1="169.95" x2="182.55" y1="62.8875" y2="62.8875"/><line style="stroke:#181818;stroke-width:0.3;" x1="182.55" x2="182.55" y1="62.8875" y2="66.7875"/><line style="stroke:#181818;stroke-width:0.3;" x1="170.25" x2="182.55" y1="66.7875" y2="66.7875"/><polygon fill="#181818" points="173.25,65.5875,170.25,66.7875,173.25,67.9875,172.05,66.7875" style="stroke:#181818;stroke-width:0.3;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="31.2" x="172.05" y="61.4306">user:currentUser()</text><polygon fill="#181818" points="261.45,74.693,264.45,75.893,261.45,77.093,262.65,75.893" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="169.95" x2="263.25" y1="75.893" y2="75.893"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="89.4" x="172.05" y="74.436">allBoardsBySystemUserWithWritePermission(user)</text><polygon fill="#181818" points="695.1,83.7984,698.1,84.9984,695.1,86.1984,696.3,84.9984" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="268.05" x2="696.9" y1="84.9984" y2="84.9984"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="79.2" x="270.15" y="83.5415">findBySystemUserWithWritePermission(user)</text><rect fill="none" height="12.4336" style="stroke:#000000;stroke-width:0.44999999999999996;" width="74.7" x="238.5" y="87.3984"/><path d="M238.5,87.3984 L257.1,87.3984 L257.1,89.7984 L254.1,92.7984 L238.5,92.7984 L238.5,87.3984 " fill="#EEEEEE" style="stroke:#000000;stroke-width:0.6;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" font-weight="bold" lengthAdjust="spacing" textLength="5.1" x="242.4" y="92.047">ref</text><text fill="#000000" font-family="FG Virgil" font-size="3.6" lengthAdjust="spacing" textLength="72.3" x="239.7" y="97.7355">SD_findBySystemUserWithWritePermission</text><polygon fill="#181818" points="271.35,106.8375,268.35,108.0375,271.35,109.2375,270.15,108.0375" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="269.55" x2="699.9" y1="108.0375" y2="108.0375"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="63.3" x="273.15" y="106.5806">allUserBoardsWithWritePermissions</text><polygon fill="#181818" points="173.25,115.943,170.25,117.143,173.25,118.343,172.05,117.143" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="171.45" x2="264.75" y1="117.143" y2="117.143"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="63.3" x="175.05" y="115.686">allUserBoardsWithWritePermissions</text><polygon fill="#181818" points="94.65,125.0484,91.65,126.2484,94.65,127.4484,93.45,126.2484" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="92.85" x2="166.65" y1="126.2484" y2="126.2484"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="63.3" x="96.45" y="124.7915">allUserBoardsWithWritePermissions</text><polygon fill="#181818" points="10.05,134.1539,7.05,135.3539,10.05,136.5539,8.85,135.3539" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="8.25" x2="88.05" y1="135.3539" y2="135.3539"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="66.3" x="11.85" y="133.897">lists the boards with write permissions</text><polygon fill="#181818" points="84.75,143.2594,87.75,144.4594,84.75,145.6594,85.95,144.4594" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="6.75" x2="86.55" y1="144.4594" y2="144.4594"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="26.7" x="8.85" y="143.0024">selects a board</text><polygon fill="#181818" points="163.35,152.3648,166.35,153.5648,163.35,154.7648,164.55,153.5648" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="91.35" x2="165.15" y1="153.5648" y2="153.5648"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="64.5" x="93.45" y="152.1079">cellsOfBoardAndUser(boardSelected)</text><line style="stroke:#181818;stroke-width:0.3;" x1="169.95" x2="182.55" y1="162.6703" y2="162.6703"/><line style="stroke:#181818;stroke-width:0.3;" x1="182.55" x2="182.55" y1="162.6703" y2="166.5703"/><line style="stroke:#181818;stroke-width:0.3;" x1="170.25" x2="182.55" y1="166.5703" y2="166.5703"/><polygon fill="#181818" points="173.25,165.3703,170.25,166.5703,173.25,167.7703,172.05,166.5703" style="stroke:#181818;stroke-width:0.3;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="31.2" x="172.05" y="161.2134">user:currentUser()</text><polygon fill="#181818" points="261.45,174.4758,264.45,175.6758,261.45,176.8758,262.65,175.6758" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="169.95" x2="263.25" y1="175.6758" y2="175.6758"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="65.1" x="172.05" y="174.2188">findCellsWithUserPostIts(board, user)</text><polygon fill="#181818" points="695.1,183.5812,698.1,184.7813,695.1,185.9813,696.3,184.7813" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="268.05" x2="696.9" y1="184.7813" y2="184.7813"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="110.4" x="270.15" y="183.3243">cellsWithOwnedPostIts = findCellsWithUserPostIts(board, user)</text><polygon fill="#181818" points="271.35,192.6867,268.35,193.8867,271.35,195.0867,270.15,193.8867" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="269.55" x2="699.9" y1="193.8867" y2="193.8867"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="40.5" x="273.15" y="192.4298">cellsWithOwnedPostIts</text><polygon fill="#181818" points="173.25,201.7922,170.25,202.9922,173.25,204.1922,172.05,202.9922" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="171.45" x2="264.75" y1="202.9922" y2="202.9922"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="40.5" x="175.05" y="201.5353">cellsWithOwnedPostIts</text><polygon fill="#181818" points="94.65,210.8977,91.65,212.0977,94.65,213.2977,93.45,212.0977" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="92.85" x2="166.65" y1="212.0977" y2="212.0977"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="40.5" x="96.45" y="210.6407">cellsWithOwnedPostIts</text><polygon fill="#181818" points="10.05,220.0031,7.05,221.2031,10.05,222.4031,8.85,221.2031" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="8.25" x2="88.05" y1="221.2031" y2="221.2031"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="74.4" x="11.85" y="219.7462">shows cells with postIts owned by the user</text><polygon fill="#181818" points="84.75,229.1086,87.75,230.3086,84.75,231.5086,85.95,230.3086" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="6.75" x2="86.55" y1="230.3086" y2="230.3086"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="58.8" x="8.85" y="228.8517">selects postIt to undo last change</text><polygon fill="#181818" points="163.35,238.2141,166.35,239.4141,163.35,240.6141,164.55,239.4141" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="91.35" x2="165.15" y1="239.4141" y2="239.4141"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="68.4" x="93.45" y="237.9571">undoLastChange(boardSelected, postIt)</text><polygon fill="#181818" points="261.45,247.3195,264.45,248.5195,261.45,249.7195,262.65,248.5195" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="169.95" x2="263.25" y1="248.5195" y2="248.5195"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="68.4" x="172.05" y="247.0626">undoLastChange(boardSelected, postIt)</text><path d="M236.4,253.0195 L254.7,253.0195 L254.7,255.525 L251.7,258.525 L236.4,258.525 L236.4,253.0195 " fill="#EEEEEE" style="stroke:#000000;stroke-width:0.44999999999999996;"/><rect fill="none" height="85.9383" style="stroke:#000000;stroke-width:0.44999999999999996;" width="483.45" x="236.4" y="253.0195"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" font-weight="bold" lengthAdjust="spacing" textLength="4.8" x="240.9" y="257.3681">alt</text><text fill="#000000" font-family="FG Virgil" font-size="3.3" font-weight="bold" lengthAdjust="spacing" textLength="40.8" x="259.2" y="257.0452">[parentCell == postItCell]</text><line style="stroke:#181818;stroke-width:0.3;" x1="268.05" x2="282.15" y1="263.7305" y2="263.7305"/><line style="stroke:#181818;stroke-width:0.3;" x1="282.15" x2="282.15" y1="263.7305" y2="267.6305"/><line style="stroke:#181818;stroke-width:0.3;" x1="269.85" x2="282.15" y1="267.6305" y2="267.6305"/><polygon fill="#181818" points="272.85,266.4305,269.85,267.6305,272.85,268.8305,271.65,267.6305" style="stroke:#181818;stroke-width:0.3;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="52.8" x="271.65" y="262.2735">deleteSatePostIt(board, postIt)</text><polygon fill="#181818" points="537.15,277.0359,540.15,278.2359,537.15,279.4359,538.35,278.2359" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="269.55" x2="538.95" y1="278.2359" y2="278.2359"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="31.2" x="271.65" y="276.779">deleteSatePostIt()</text><polygon fill="#181818" points="695.1,295.1414,698.1,296.3414,695.1,297.5414,696.3,296.3414" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="268.05" x2="696.9" y1="296.3414" y2="296.3414"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="19.8" x="270.15" y="294.8845">save(board)</text><polygon fill="#181818" points="465.75,313.2469,468.75,314.4469,465.75,315.6469,466.95,314.4469" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="268.05" x2="467.55" y1="314.4469" y2="314.4469"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="30.6" x="270.15" y="312.9899">undoPostIt(postIt)</text><polygon fill="#181818" points="538.65,322.3523,541.65,323.5523,538.65,324.7523,539.85,323.5523" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="473.85" x2="540.45" y1="323.5523" y2="323.5523"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="62.7" x="475.95" y="322.0954">postItFromUndo = newPostIt(parent)</text><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="473.85" x2="486.45" y1="332.6578" y2="332.6578"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="486.45" x2="486.45" y1="332.6578" y2="336.5578"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="474.15" x2="486.45" y1="336.5578" y2="336.5578"/><polygon fill="#181818" points="477.15,335.3578,474.15,336.5578,477.15,337.7578,475.95,336.5578" style="stroke:#181818;stroke-width:0.3;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="52.2" x="475.95" y="331.2009">postItList.add(posItFromUndo)</text><path d="M236.4,343.1578 L254.7,343.1578 L254.7,345.6633 L251.7,348.6633 L236.4,348.6633 L236.4,343.1578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:0.44999999999999996;"/><rect fill="none" height="82.0383" style="stroke:#000000;stroke-width:0.44999999999999996;" width="483.45" x="236.4" y="343.1578"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" font-weight="bold" lengthAdjust="spacing" textLength="4.8" x="240.9" y="347.5063">alt</text><text fill="#000000" font-family="FG Virgil" font-size="3.3" font-weight="bold" lengthAdjust="spacing" textLength="39.9" x="259.2" y="347.1835">[parentCell != postItCell]</text><line style="stroke:#181818;stroke-width:0.3;" x1="268.05" x2="282.15" y1="353.8688" y2="353.8688"/><line style="stroke:#181818;stroke-width:0.3;" x1="282.15" x2="282.15" y1="353.8688" y2="357.7688"/><line style="stroke:#181818;stroke-width:0.3;" x1="269.85" x2="282.15" y1="357.7688" y2="357.7688"/><polygon fill="#181818" points="272.85,356.5687,269.85,357.7688,272.85,358.9688,271.65,357.7688" style="stroke:#181818;stroke-width:0.3;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="52.8" x="271.65" y="352.4118">deleteSatePostIt(board, postIt)</text><polygon fill="#181818" points="537.15,367.1742,540.15,368.3742,537.15,369.5742,538.35,368.3742" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="269.55" x2="538.95" y1="368.3742" y2="368.3742"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="31.2" x="271.65" y="366.9173">deleteSatePostIt()</text><polygon fill="#181818" points="695.1,385.2797,698.1,386.4797,695.1,387.6797,696.3,386.4797" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="268.05" x2="696.9" y1="386.4797" y2="386.4797"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="19.8" x="270.15" y="385.0228">save(board)</text><polygon fill="#181818" points="465.75,403.3852,468.75,404.5852,465.75,405.7852,466.95,404.5852" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="268.05" x2="467.55" y1="404.5852" y2="404.5852"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="30.6" x="270.15" y="403.1282">undoPostIt(postIt)</text><polygon fill="#181818" points="538.65,412.4906,541.65,413.6906,538.65,414.8906,539.85,413.6906" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="472.35" x2="540.45" y1="413.6906" y2="413.6906"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="62.7" x="474.45" y="412.2337">postItFromUndo = newPostIt(parent)</text><polygon fill="#181818" points="413.25,421.5961,410.25,422.7961,413.25,423.9961,412.05,422.7961" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="411.45" x2="469.05" y1="422.7961" y2="422.7961"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="52.2" x="415.05" y="421.3392">postItList.add(posItFromUndo)</text><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="268.05" x2="282.15" y1="432.5016" y2="432.5016"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="282.15" x2="282.15" y1="432.5016" y2="436.4016"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="269.85" x2="282.15" y1="436.4016" y2="436.4016"/><polygon fill="#181818" points="272.85,435.2016,269.85,436.4016,272.85,437.6016,271.65,436.4016" style="stroke:#181818;stroke-width:0.3;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="134.7" x="271.65" y="431.0446">registerPrimaryBoardModification(board, postIt, ModificationType.UNDO, cell);</text><polygon fill="#181818" points="596.25,445.807,599.25,447.007,596.25,448.207,597.45,447.007" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="269.55" x2="598.05" y1="447.007" y2="447.007"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="69.9" x="271.65" y="445.5501">addUndoModification(createdPostIt, cell)</text><polygon fill="#181818" points="652.05,454.9125,655.05,456.1125,652.05,457.3125,653.25,456.1125" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="602.85" x2="653.85" y1="456.1125" y2="456.1125"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="44.1" x="604.95" y="454.6556">createBoardModification()</text><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="602.85" x2="615.45" y1="466.718" y2="466.718"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="615.45" x2="615.45" y1="466.718" y2="470.618"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="601.35" x2="615.45" y1="470.618" y2="470.618"/><polygon fill="#181818" points="604.35,469.418,601.35,470.618,604.35,471.818,603.15,470.618" style="stroke:#181818;stroke-width:0.3;"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="47.1" x="604.95" y="465.261">addBoardModification(mod)</text><polygon fill="#181818" points="695.1,477.0234,698.1,478.2234,695.1,479.4234,696.3,478.2234" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;" x1="268.05" x2="696.9" y1="478.2234" y2="478.2234"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="19.8" x="270.15" y="476.7665">save(board)</text><polygon fill="#181818" points="271.35,486.1289,268.35,487.3289,271.35,488.5289,270.15,487.3289" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="269.55" x2="699.9" y1="487.3289" y2="487.3289"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="24" x="273.15" y="485.872">updatedBoard</text><polygon fill="#181818" points="173.25,495.2344,170.25,496.4344,173.25,497.6344,172.05,496.4344" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="171.45" x2="264.75" y1="496.4344" y2="496.4344"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="24" x="175.05" y="494.9774">updatedBoard</text><polygon fill="#181818" points="94.65,504.3398,91.65,505.5398,94.65,506.7398,93.45,505.5398" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="92.85" x2="166.65" y1="505.5398" y2="505.5398"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="24" x="96.45" y="504.0829">updatedBoard</text><polygon fill="#181818" points="10.05,513.4453,7.05,514.6453,10.05,515.8453,8.85,514.6453" style="stroke:#181818;stroke-width:0.3;"/><line style="stroke:#181818;stroke-width:0.3;stroke-dasharray:2.0,2.0;" x1="8.25" x2="89.55" y1="514.6453" y2="514.6453"/><text fill="#000000" font-family="FG Virgil" font-size="3.9" lengthAdjust="spacing" textLength="30.3" x="11.85" y="513.1884">displays success</text><!--MD5=[dddce8739eab633c1f8f1257990974b5]
@startuml
'http://plantuml.com/skinparam.html
skinparam handwritten false
skinparam packageStyle rect
skinparam defaultFontName FG Virgil
skinparam shadowing false

actor User as Actor
participant UndoLastChangeInPostItUI as UI <<presentation>>
participant UndoLastChangeInPostItController as Controller <<application>>

participant BoardManagementService as BoardManagementService <<application>>


participant parentCell as cell2 <<domain>>
participant Cell as cell <<domain>>
participant postIt as postIt <<domain>>
participant postItParent as parent <<domain>>
participant SharedBoard as SharedBoard <<domain>>
participant "mod : BoardModification" as modification <<domain>>
database boardRepository as BoardRepository <<repository>>



Actor - -> UI: undo last change in PostIt
activate UI
UI -> Controller: create()
UI -> Controller: sharedBoardsWithWritePermission()
activate Controller
Controller -> Controller : user:currentUser()
Controller -> BoardManagementService: allBoardsBySystemUserWithWritePermission(user)
activate BoardManagementService

BoardManagementService -> BoardRepository: findBySystemUserWithWritePermission(user)
ref over BoardManagementService : SD_findBySystemUserWithWritePermission
activate BoardRepository

BoardRepository - -> BoardManagementService: allUserBoardsWithWritePermissions
deactivate BoardRepository

BoardManagementService - -> Controller: allUserBoardsWithWritePermissions
Controller - -> UI: allUserBoardsWithWritePermissions
UI - -> Actor: lists the boards with write permissions
Actor -> UI: selects a board

UI -> Controller : cellsOfBoardAndUser(boardSelected)
Controller -> Controller : user:currentUser()
Controller -> BoardManagementService : findCellsWithUserPostIts(board, user)

BoardManagementService -> BoardRepository: cellsWithOwnedPostIts = findCellsWithUserPostIts(board, user)
activate BoardRepository
BoardRepository - -> BoardManagementService : cellsWithOwnedPostIts
deactivate BoardRepository
BoardManagementService - -> Controller : cellsWithOwnedPostIts


Controller - -> UI : cellsWithOwnedPostIts


UI - -> Actor : shows cells with postIts owned by the user
Actor -> UI: selects postIt to undo last change

                        UI -> Controller : undoLastChange(boardSelected, postIt)
                                         Controller -> BoardManagementService : undoLastChange(boardSelected, postIt)
                                           alt parentCell == postItCell

                                          BoardManagementService -> BoardManagementService : deleteSatePostIt(board, postIt)
                                          activate BoardManagementService
                                               BoardManagementService - -> postIt : deleteSatePostIt()
                                               activate postIt
                                               deactivate postIt
                                               deactivate BoardManagementService
                                               BoardManagementService - -> BoardRepository : save(board)
                                               activate BoardRepository
                                               deactivate BoardRepository
                                               BoardManagementService - -> cell : undoPostIt(postIt)
                                               activate cell
                                               cell - -> postIt : postItFromUndo = newPostIt(parent)
                                               activate cell
                                               cell - -> cell : postItList.add(posItFromUndo)
                                                end
                                                deactivate cell
                                                deactivate cell


                                        alt parentCell != postItCell

                                          BoardManagementService -> BoardManagementService : deleteSatePostIt(board, postIt)
                                          activate BoardManagementService
                                               BoardManagementService - -> postIt : deleteSatePostIt()
                                               activate postIt
                                               deactivate postIt
                                               deactivate BoardManagementService
                                               BoardManagementService - -> BoardRepository : save(board)
                                               activate BoardRepository
                                               deactivate BoardRepository
                                               BoardManagementService - -> cell : undoPostIt(postIt)
                                               activate cell

                                               cell - -> postIt : postItFromUndo = newPostIt(parent)
                                               activate cell2
                                               cell - -> cell2 : postItList.add(posItFromUndo)
                                                end
                                                 deactivate cell
                                                deactivate cell2





                                              BoardManagementService - -> BoardManagementService : registerPrimaryBoardModification(board, postIt, ModificationType.UNDO, cell);
                                              activate BoardManagementService
                                               BoardManagementService - -> SharedBoard : addUndoModification(createdPostIt, cell)
                                              activate SharedBoard

                                              SharedBoard - -> modification : createBoardModification()
                                              SharedBoard - -> SharedBoard : addBoardModification(mod)
                                               deactivate BoardManagementService
  BoardManagementService -> BoardRepository: save(board)
  deactivate SharedBoard
             activate BoardRepository

         BoardRepository - - -> BoardManagementService : updatedBoard
      deactivate BoardRepository


         BoardManagementService - -> Controller : updatedBoard
          Controller - -> UI : updatedBoard

         UI - -> Actor : displays success


         deactivate Controller
deactivate UI
@enduml

@startuml
skinparam handwritten false
skinparam packageStyle rect
skinparam defaultFontName FG Virgil
skinparam shadowing false

actor User as Actor
participant UndoLastChangeInPostItUI as UI <<presentation>>
participant UndoLastChangeInPostItController as Controller <<application>>

participant BoardManagementService as BoardManagementService <<application>>


participant parentCell as cell2 <<domain>>
participant Cell as cell <<domain>>
participant postIt as postIt <<domain>>
participant postItParent as parent <<domain>>
participant SharedBoard as SharedBoard <<domain>>
participant "mod : BoardModification" as modification <<domain>>
database boardRepository as BoardRepository <<repository>>



Actor - -> UI: undo last change in PostIt
activate UI
UI -> Controller: create()
UI -> Controller: sharedBoardsWithWritePermission()
activate Controller
Controller -> Controller : user:currentUser()
Controller -> BoardManagementService: allBoardsBySystemUserWithWritePermission(user)
activate BoardManagementService

BoardManagementService -> BoardRepository: findBySystemUserWithWritePermission(user)
ref over BoardManagementService : SD_findBySystemUserWithWritePermission
activate BoardRepository

BoardRepository - -> BoardManagementService: allUserBoardsWithWritePermissions
deactivate BoardRepository

BoardManagementService - -> Controller: allUserBoardsWithWritePermissions
Controller - -> UI: allUserBoardsWithWritePermissions
UI - -> Actor: lists the boards with write permissions
Actor -> UI: selects a board

UI -> Controller : cellsOfBoardAndUser(boardSelected)
Controller -> Controller : user:currentUser()
Controller -> BoardManagementService : findCellsWithUserPostIts(board, user)

BoardManagementService -> BoardRepository: cellsWithOwnedPostIts = findCellsWithUserPostIts(board, user)
activate BoardRepository
BoardRepository - -> BoardManagementService : cellsWithOwnedPostIts
deactivate BoardRepository
BoardManagementService - -> Controller : cellsWithOwnedPostIts


Controller - -> UI : cellsWithOwnedPostIts


UI - -> Actor : shows cells with postIts owned by the user
Actor -> UI: selects postIt to undo last change

                        UI -> Controller : undoLastChange(boardSelected, postIt)
                                         Controller -> BoardManagementService : undoLastChange(boardSelected, postIt)
                                           alt parentCell == postItCell

                                          BoardManagementService -> BoardManagementService : deleteSatePostIt(board, postIt)
                                          activate BoardManagementService
                                               BoardManagementService - -> postIt : deleteSatePostIt()
                                               activate postIt
                                               deactivate postIt
                                               deactivate BoardManagementService
                                               BoardManagementService - -> BoardRepository : save(board)
                                               activate BoardRepository
                                               deactivate BoardRepository
                                               BoardManagementService - -> cell : undoPostIt(postIt)
                                               activate cell
                                               cell - -> postIt : postItFromUndo = newPostIt(parent)
                                               activate cell
                                               cell - -> cell : postItList.add(posItFromUndo)
                                                end
                                                deactivate cell
                                                deactivate cell


                                        alt parentCell != postItCell

                                          BoardManagementService -> BoardManagementService : deleteSatePostIt(board, postIt)
                                          activate BoardManagementService
                                               BoardManagementService - -> postIt : deleteSatePostIt()
                                               activate postIt
                                               deactivate postIt
                                               deactivate BoardManagementService
                                               BoardManagementService - -> BoardRepository : save(board)
                                               activate BoardRepository
                                               deactivate BoardRepository
                                               BoardManagementService - -> cell : undoPostIt(postIt)
                                               activate cell

                                               cell - -> postIt : postItFromUndo = newPostIt(parent)
                                               activate cell2
                                               cell - -> cell2 : postItList.add(posItFromUndo)
                                                end
                                                 deactivate cell
                                                deactivate cell2





                                              BoardManagementService - -> BoardManagementService : registerPrimaryBoardModification(board, postIt, ModificationType.UNDO, cell);
                                              activate BoardManagementService
                                               BoardManagementService - -> SharedBoard : addUndoModification(createdPostIt, cell)
                                              activate SharedBoard

                                              SharedBoard - -> modification : createBoardModification()
                                              SharedBoard - -> SharedBoard : addBoardModification(mod)
                                               deactivate BoardManagementService
  BoardManagementService -> BoardRepository: save(board)
  deactivate SharedBoard
             activate BoardRepository

         BoardRepository - - -> BoardManagementService : updatedBoard
      deactivate BoardRepository


         BoardManagementService - -> Controller : updatedBoard
          Controller - -> UI : updatedBoard

         UI - -> Actor : displays success


         deactivate Controller
deactivate UI
@enduml

PlantUML version 1.2022.12(Sun Oct 23 19:12:26 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: pt
Country: PT
--></g></svg>